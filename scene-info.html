<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>3D con información — Oído</title>
  <link rel="stylesheet" href="css/styles.css"/>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  
<script src="https://cdn.jsdelivr.net/npm/aframe-orbit-controls@1.3.1/dist/aframe-orbit-controls.min.js"></script>
<script>
  // Auto-fit camera to model using THREE.Box3 bounding box
  function fitCameraToModel(sceneEl, modelEl, controlsEl){
    modelEl.addEventListener('model-loaded', () => {
      const obj = modelEl.getObject3D('mesh');
      if(!obj){ console.warn('No mesh in model'); return; }
      obj.updateWorldMatrix(true, true);
      const box = new THREE.Box3().setFromObject(obj);
      const size = new THREE.Vector3();
      const center = new THREE.Vector3();
      box.getSize(size);
      box.getCenter(center);
      // Set orbit target
      if(controlsEl){ controlsEl.components['orbit-controls'].controls.target.copy(center); }
      // Compute distance from FOV
      const camera = sceneEl.camera;
      const maxDim = Math.max(size.x, size.y, size.z);
      const fov = camera.fov * (Math.PI/180);
      const dist = (maxDim/2) / Math.tan(fov/2) + 0.5*maxDim;
      const dir = new THREE.Vector3(0.7, 0.5, 1).normalize();
      const camPos = center.clone().add(dir.multiplyScalar(dist));
      camera.position.copy(camPos);
      camera.near = dist/100;
      camera.far  = dist*10;
      camera.updateProjectionMatrix();
    });
  }
</script>

  <script>
    AFRAME.registerComponent('hotspot', {
      schema: { label: {type:'string'}, desc: {type:'string'}, color:{type:'string', default:'#fff'} },
      init(){
        const el = this.el, d = this.data;
        const sphere = document.createElement('a-sphere');
        sphere.setAttribute('radius','0.012');
        sphere.setAttribute('color', d.color);
        sphere.setAttribute('opacity','0.95');
        el.appendChild(sphere);
        el.addEventListener('click', ()=> {
          const title = document.querySelector('#info-title');
          const body = document.querySelector('#info-body');
          title.textContent = d.label;
          body.textContent = d.desc;
        });
      }
    });
  </script>
</head>
<body>
  
<!-- v6: gradient defs + color-specific icons -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="g-blue" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#60a5fa"/><stop offset="100%" stop-color="#3b82f6"/></linearGradient>
    <linearGradient id="g-green" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#34d399"/><stop offset="100%" stop-color="#10b981"/></linearGradient>
    <linearGradient id="g-orange" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient>
    <linearGradient id="g-purple" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient>
  </defs>
</svg>
<svg width="0" height="0" style="position:absolute">
  <!-- Home purple -->
  <symbol id="ico-home-purple" viewBox="0 0 24 24">
    <path fill="url(#g-purple)" d="M12 3l9 8h-3v9h-5v-6h-2v6H6v-9H3l9-8z"/>
  </symbol>
  <!-- 3D blue -->
  <symbol id="ico-3d-blue" viewBox="0 0 24 24">
    <path fill="url(#g-blue)" d="M12 2l9 5v10l-9 5-9-5V7l9-5zm0 2.2L5 7v8l7 3.8 7-3.8V7L12 4.2z"/>
  </symbol>
  <!-- Info green -->
  <symbol id="ico-info-green" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10" fill="none" stroke="url(#g-green)" stroke-width="2"/>
    <path fill="url(#g-green)" d="M11 10h2v7h-2zM11 6h2v2h-2z"/>
  </symbol>
  <!-- AR orange -->
  <symbol id="ico-ar-orange" viewBox="0 0 24 24">
    <path fill="url(#g-orange)" d="M12 2l7 4v12l-7 4-7-4V6l7-4zm0 2.2L7 6.5v7l5 2.8 5-2.8v-7L12 4.2z"/>
  </symbol>
</svg>

  


  <div class="container">
    <header class="header">
      <div class="brand"><div class="logo"><svg viewBox="0 0 24 24"><use href="#ico-info-green"></use></svg></div><h1>3D con información — Oído</h1></div>
      
      <nav class="actions">
        <a class="btn grad-purple" href="index.html">
          <svg class="ico"><use href="#ico-home-purple"/></svg> Inicio
        </a>
        <a class="btn grad-blue" href="scene-simple.html">
          <svg class="ico"><use href="#ico-3d-blue"/></svg> Vista 3D simple
        </a>
        <a class="btn grad-green" href="scene-info.html">
          <svg class="ico"><use href="#ico-info-green"/></svg> 3D con información
        </a>
        <a class="btn grad-orange" href="ar.html">
          <svg class="ico"><use href="#ico-ar-orange"/></svg> Realidad Aumentada
        </a>
      </nav>
    
    </header>

    <div class="row">
      <section class="card" style="flex:1; padding:0; overflow:hidden">
        <div style="height:70vh;min-height:420px">
          <a-scene renderer="antialias:true">
            <a-assets>
              <a-asset-item id="mdl" src="assets/models/oido.glb"></a-asset-item>
            </a-assets>

            <a-entity id="model" gltf-model="#mdl" position="0 1.2 -1.2"></a-entity>

            <!-- Hotspots iniciales (ajusta posiciones al GLB real si varía) -->
            <a-entity hotspot="label: Pabellón auricular; desc: Parte externa que capta el sonido.; color: #60a5fa" position="-0.05 1.3 -1.0"></a-entity>
            <a-entity hotspot="label: Tímpano; desc: Membrana que vibra con ondas sonoras.; color: #f59e0b" position="0 1.2 -1.0"></a-entity>
            <a-entity hotspot="label: Cadena osicular; desc: Martillo, yunque y estribo amplifican la vibración.; color: #34d399" position="0.05 1.22 -1.0"></a-entity>
            <a-entity hotspot="label: Cóclea; desc: Transforma vibraciones en impulsos nerviosos.; color: #c084fc" position="0.12 1.16 -1.05"></a-entity>
            <a-entity hotspot="label: Canales semicirculares; desc: Órganos del equilibrio.; color: #a78bfa" position="0.16 1.26 -1.08"></a-entity>
            <a-entity hotspot="label: Trompa de Eustaquio; desc: Regula la presión del oído medio.; color: #fbbf24" position="-0.02 1.1 -0.98"></a-entity>

            <a-entity id="rig" position="0 1.6 0">
              <a-entity id="camera" camera look-controls="enabled:false" orbit-controls="autoRotate:false; target: 0 1.2 -1.2; minDistance:0.1; maxDistance:100; enablePan:true; enableDamping:true; dampingFactor:0.15;"></a-entity>
            </a-entity>

            <a-entity light="type: ambient; intensity: 1.0"></a-entity>
            <a-entity light="type: directional; intensity: 0.8" position="1 2 1"></a-entity>
            <a-sky color="#0b1020"></a-sky>
          </a-scene>
        </div>
      </section>

      <aside class="sidebar">
        <section class="card">
          <h3 id="info-title">Selecciona una parte del oído</h3>
          <p id="info-body">Haz clic en los puntos para ver su descripción aquí.</p>
          <ul class="clean">
            <li>Externo: pabellón auricular, conducto auditivo.</li>
            <li>Medio: tímpano, martillo, yunque, estribo.</li>
            <li>Interno: cóclea, canales semicirculares, nervio auditivo.</li>
          </ul>
        </section>
      </aside>
    </div>
  </div>

  <script>
    const scene = document.querySelector('a-scene');
    const model = document.querySelector('#model');
    const cam = document.querySelector('#camera');
    fitCameraToModel(scene, model, cam);
  </script>

    <footer class="footer">
      <small>© 2025 Proyecto AR Biología — Liceo Bicentenario de Excelencia Polivalente San Nicolás. Todos los derechos reservados.</small>
    </footer>


<script>
// v5: Basic client-side protections (deterrent only)
(function(){
  const block = (e)=>{ e.preventDefault(); e.stopPropagation(); return false; };
  // Disable right-click context menu
  document.addEventListener('contextmenu', block, {capture:true});
  // Disable common key combos (F12, Ctrl+Shift+I/J/C, Ctrl+U, Ctrl+S, Ctrl+P)
  document.addEventListener('keydown', function(e){
    const k = e.key.toLowerCase();
    if (k === 'f12') return block(e);
    if (e.ctrlKey && e.shiftKey && ['i','j','c'].includes(k)) return block(e);
    if (e.ctrlKey && ['u','s','p'].includes(k)) return block(e);
  }, {capture:true});
  // (Optional) Disable drag on images
  document.addEventListener('dragstart', block, {capture:true});
})();
</script>

</body>
</html>
