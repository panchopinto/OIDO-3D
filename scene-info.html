
<!DOCTYPE html><html lang="es"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>3D con información — Oído</title>
<link rel="stylesheet" href="css/styles.css"/>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head><body>
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="g-blue" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#60a5fa"/><stop offset="100%" stop-color="#3b82f6"/></linearGradient>
    <linearGradient id="g-green" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#34d399"/><stop offset="100%" stop-color="#10b981"/></linearGradient>
    <linearGradient id="g-orange" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient>
    <linearGradient id="g-purple" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient>
  </defs>
</svg>
<svg width="0" height="0" style="position:absolute">
  <symbol id="ico-home" viewBox="0 0 24 24"><path fill="url(#g-purple)" d="M12 3l9 8h-3v9h-5v-6h-2v6H6v-9H3l9-8z"/></symbol>
  <symbol id="ico-3d" viewBox="0 0 24 24"><path fill="url(#g-blue)" d="M12 2l9 5v10l-9 5-9-5V7l9-5zm0 2.2L5 7v8l7 3.8 7-3.8V7L12 4.2z"/></symbol>
  <symbol id="ico-info" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="url(#g-green)" stroke-width="2"/><path fill="url(#g-green)" d="M11 10h2v7h-2zM11 6h2v2h-2z"/></symbol>
  <symbol id="ico-ar" viewBox="0 0 24 24"><path fill="url(#g-orange)" d="M12 2l7 4v12l-7 4-7-4V6l7-4zm0 2.2L7 6.5v7l5 2.8 5-2.8v-7L12 4.2z"/></symbol>
</svg>

<div class="container">
<header class="header">
  <div class="brand"><div class="logo"><svg viewBox="0 0 24 24"><use href="#ico-info"/></svg></div><h1>3D con información — Oído</h1></div>
  <nav class="actions">
    <button id="themeToggle" class="theme-btn" type="button"><svg viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zM1 13h3v-2H1v2zm10-9h-2v3h2V4zm7.04.46l-1.41-1.41-1.8 1.79 1.41 1.41 1.8-1.79zM20 11v2h3v-2h-3zm-9 9h2v-3h-2v3zm6.24-1.84l1.8 1.79 1.41-1.41-1.79-1.8-1.42 1.42zM12 6a6 6 0 100 12 6 6 0 000-12z"/></svg></button>
    <a class="btn grad-purple" href="index.html"><span class="badge grad-d"><svg viewBox="0 0 24 24"><use href="#ico-home"/></svg></span> Inicio</a>
    <a class="btn grad-blue" href="scene-simple.html"><span class="badge grad-a"><svg viewBox="0 0 24 24"><use href="#ico-3d"/></svg></span> 3D simple</a>
    <a class="btn grad-orange" href="ar.html"><span class="badge grad-c"><svg viewBox="0 0 24 24"><use href="#ico-ar"/></svg></span> AR</a>
  </nav>
</header>
<section class="card">
  <div class="layout">
    <aside class="side"><h4>Partes</h4><ul id="partsList"></ul></aside>
    <div>
      <div class="toolbar">
        <button class="toolbtn" id="btn-info" title="Ver info"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="#7dd3fc" stroke-width="2"/><path fill="#7dd3fc" d="M11 10h2v7h-2zM11 6h2v2h-2z"/></svg></button>
        <button class="toolbtn" id="btn-auto" title="Auto-rotar"><svg viewBox="0 0 24 24"><path fill="#34d399" d="M12 2v3l4-4-4-4v3A10 10 0 1022 12h-2a8 8 0 11-8-8z"/></svg></button>
        <button class="toolbtn" id="btn-zoom-in" title="Acercar (+)"><svg viewBox="0 0 24 24"><path fill="#60a5fa" d="M10 10V6h2v4h4v2h-4v4h-2v-4H6v-2z"/><path fill="#60a5fa" d="M21 21l-4.35-4.35"/></svg></button>
        <button class="toolbtn" id="btn-zoom-out" title="Alejar (-)"><svg viewBox="0 0 24 24"><path fill="#fbbf24" d="M6 11h8v2H6z"/><path fill="#fbbf24" d="M21 21l-4.35-4.35"/></svg></button>
        <button class="toolbtn" id="btn-reset" title="Reiniciar vista"><svg viewBox="0 0 24 24"><path fill="#c084fc" d="M12 5V2L7 6l5 4V7c3 0 5 2 5 5a5 5 0 11-9.9 1H5a7 7 0 1014 0c0-3.87-3.13-7-7-7z"/></svg></button>
        <button class="toolbtn" id="btn-hotspots" title="Mostrar/Ocultar etiquetas"><svg viewBox="0 0 24 24"><path fill="#e879f9" d="M12 5c4 0 7 3 7 7s-3 7-7 7-7-3-7-7 3-7 7-7zm0 2a5 5 0 100 10 5 5 0 000-10z"/><circle cx="12" cy="12" r="2" fill="#e879f9"/></svg></button>
        <button class="toolbtn" id="btn-prev" title="Anterior"><svg viewBox="0 0 24 24"><path fill="#7dd3fc" d="M15 6l-6 6 6 6V6z"/></svg></button>
        <button class="toolbtn" id="btn-play" title="Iniciar tour"><svg viewBox="0 0 24 24"><path fill="#34d399" d="M8 5v14l11-7z"/></svg></button>
        <button class="toolbtn" id="btn-pause" title="Pausar tour"><svg viewBox="0 0 24 24"><path fill="#f59e0b" d="M7 5h4v14H7zM13 5h4v14h-4z"/></svg></button>
        <button class="toolbtn" id="btn-next" title="Siguiente"><svg viewBox="0 0 24 24"><path fill="#7dd3fc" d="M9 6l6 6-6 6V6z"/></svg></button>
        <button class="toolbtn" id="btn-settings" title="Ajustes"><svg viewBox="0 0 24 24"><path fill="#93c5fd" d="M12 8a4 4 0 100 8 4 4 0 000-8zm9 4l-2-.5a7.9 7.9 0 00-1.1-2.6l1.2-1.6-2-2-1.6 1.2A7.9 7.9 0 0012.5 5L12 3h-2l-.5 2A7.9 7.9 0 006.9 6.6L5.3 5.4l-2 2 1.2 1.6A7.9 7.9 0 004.5 12L3 12.5v2l1.5.5c.2.9.6 1.8 1.1 2.6L4.4 19.2l2 2 1.6-1.2c.8.5 1.7.9 2.6 1.1l.5 1.9h2l.5-1.9c.9-.2 1.8-.6 2.6-1.1l1.6 1.2 2-2-1.2-1.6c.5-.8.9-1.7 1.1-2.6l2-.5v-2z"/></svg></button>
      </div>
      <mv-wrapper>
        <model-viewer id="mv" src="assets/models/oido.glb" camera-controls touch-action="pan-y" exposure="1.1" shadow-intensity="0.5">
          <button class="hotspot" slot="hotspot-1" data-position="-0.055 0.065 -0.082" data-normal="0 1 0" data-visibility-attribute="visible">Pabellón auricular</button>
          <button class="hotspot" slot="hotspot-2" data-position="0.002 0.018 -0.052" data-normal="0 1 0" data-visibility-attribute="visible">Tímpano</button>
          <button class="hotspot" slot="hotspot-3" data-position="0.034 0.021 -0.051" data-normal="0 1 0" data-visibility-attribute="visible">Cadena osicular</button>
          <button class="hotspot" slot="hotspot-4" data-position="0.084 -0.012 -0.082" data-normal="0 1 0" data-visibility-attribute="visible">Cóclea</button>
          <button class="hotspot" slot="hotspot-5" data-position="0.112 0.032 -0.091" data-normal="0 1 0" data-visibility-attribute="visible">Canales semicirculares</button>
          <button class="hotspot" slot="hotspot-6" data-position="-0.024 -0.028 -0.041" data-normal="0 1 0" data-visibility-attribute="visible">Trompa de Eustaquio</button>
        </model-viewer>
      </mv-wrapper>
      <div class="loader"><span id="mvProgress"></span></div>
      <div class="panel" id="info-panel">
        <h3 id="info-title">Partes del oído</h3>
        <p id="info-desc">Toca un hotspot o usa el botón <em>info</em> para ver una breve descripción.</p>
        <ul class="clean">
          <li><strong>Externo:</strong> pabellón auricular, conducto auditivo.</li>
          <li><strong>Medio:</strong> tímpano, martillo, yunque, estribo.</li>
          <li><strong>Interno:</strong> cóclea, canales semicirculares, nervio auditivo.</li>
        </ul>
      </div>
    </div>
  </div>
</section>
<footer class="footer">
  <small>Proyecto desarrollado por <strong>Belén Acuña</strong> y <strong>Francisco Pinto</strong>. Uso exclusivamente educativo. <strong>Prohibida</strong> su reproducción, copia o distribución total o parcial sin autorización. © 2025</small>
</footer>
</div>
<script>
(function(){
  const block = (e)=>{ e.preventDefault(); e.stopPropagation(); return false; };
  document.addEventListener('contextmenu', block, {capture:true});
  document.addEventListener('keydown', function(e){
    const k = e.key.toLowerCase();
    if (k === 'f12') return block(e);
    if (e.ctrlKey && e.shiftKey && ['i','j','c'].includes(k)) return block(e);
    if (e.ctrlKey && ['u','s','p'].includes(k)) return block(e);
  }, {capture:true});
})();
</script>

<script>
(function(){
  const mv=document.getElementById('mv');
  const infoPanel=document.getElementById('info-panel');
  const titleEl=document.getElementById('info-title');
  const descEl=document.getElementById('info-desc');
  const INFO={
    "Pabellón auricular":"Parte externa que capta y canaliza el sonido hacia el conducto auditivo.",
    "Tímpano":"Membrana que vibra con las ondas sonoras; separa el oído externo del medio.",
    "Cadena osicular":"Martillo, yunque y estribo; amplifican la vibración del tímpano hacia la cóclea.",
    "Cóclea":"Convierte vibraciones en impulsos nerviosos (audición).",
    "Canales semicirculares":"Detectan movimientos de rotación; esenciales para el equilibrio.",
    "Trompa de Eustaquio":"Equilibra la presión del oído medio con la presión atmosférica."
  };
  // number badges
  Array.from(mv.querySelectorAll('.hotspot')).forEach((h,i)=>h.setAttribute('data-n', String(i+1)));
  // sidebar population
  const list=document.getElementById('partsList');
  Array.from(mv.querySelectorAll('.hotspot')).forEach((h,i)=>{
    const li=document.createElement('li');
    li.innerHTML='<span class="badge-num">'+(i+1)+'</span> <button class="btn grad-blue" style="padding:6px 10px;border-radius:10px">'+h.textContent.trim()+'</button>';
    li.querySelector('button').addEventListener('click',()=>{ h.click(); h.scrollIntoView({block:'center',behavior:'smooth'}); });
    list.appendChild(li);
  });
  // hotspot click
  mv.addEventListener('click',(ev)=>{
    const t=ev.target;
    if(t.classList && t.classList.contains('hotspot')){
      const name=t.textContent.trim();
      titleEl.textContent=name;
      descEl.textContent=INFO[name]||"Parte del oído.";
    }
  });
  // toolbar controls
  function getOrbit(){ const o=mv.getCameraOrbit(); return {theta:o.theta,phi:o.phi,radius:o.radius}; }
  function setOrbit(theta,phi,radius){ mv.cameraOrbit = theta+' '+phi+' '+radius; }
  document.getElementById('btn-info').addEventListener('click',()=>{ infoPanel.scrollIntoView({behavior:'smooth',block:'center'}); });
  document.getElementById('btn-auto').addEventListener('click',()=>{ mv.autoRotate=!mv.autoRotate; });
  document.getElementById('btn-zoom-in').addEventListener('click',()=>{ const o=getOrbit(); setOrbit(o.theta,o.phi,Math.max(0.05,o.radius*0.9)); });
  document.getElementById('btn-zoom-out').addEventListener('click',()=>{ const o=getOrbit(); setOrbit(o.theta,o.phi,Math.min(10,o.radius*1.1)); });
  document.getElementById('btn-reset').addEventListener('click',()=>{ mv.resetTurntableRotation(); mv.cameraOrbit='auto auto auto'; });
  let hotspotsVisible=true;
  document.getElementById('btn-hotspots').addEventListener('click',()=>{
    hotspotsVisible=!hotspotsVisible;
    mv.querySelectorAll('.hotspot').forEach(h=>h.style.display=hotspotsVisible?'inline-block':'none');
  });
  // tour
  const steps=Array.from(mv.querySelectorAll('.hotspot')); let idx=0; let timer=null; const DUR=3200;
  function focusStep(i){
    idx=(i+steps.length)%steps.length;
    const st=steps[idx];
    const o=mv.getCameraOrbit();
    const r=Math.max(0.08,o.radius*0.85);
    const pos=(st.dataset.position||'0 0 0').trim().split(/\s+/).map(Number);
    mv.cameraTarget = pos[0]+'m '+pos[1]+'m '+pos[2]+'m';
    mv.cameraOrbit = o.theta+' '+o.phi+' '+r;
    titleEl.textContent=st.textContent.trim();
    descEl.textContent=INFO[titleEl.textContent]||'Parte del oído';
    document.dispatchEvent(new CustomEvent('tour-step',{detail:{index:idx,total:steps.length}}));
  }
  function play(){ if(timer) return; mv.autoRotate=false; focusStep(idx); timer=setInterval(()=>focusStep(idx+1),DUR); }
  function pause(){ if(timer){ clearInterval(timer); timer=null; } }
  document.getElementById('btn-play').addEventListener('click',play);
  document.getElementById('btn-pause').addEventListener('click',pause);
  document.getElementById('btn-next').addEventListener('click',()=>{ pause(); focusStep(idx+1); });
  document.getElementById('btn-prev').addEventListener('click',()=>{ pause(); focusStep(idx-1); });
  // progress pill & loader
  const pill=document.createElement('div'); pill.className='progress-pill'; pill.id='tourProgress'; pill.textContent='1 / '+steps.length;
  document.querySelector('.toolbar').insertAdjacentElement('beforebegin',pill);
  const barSpan=document.getElementById('mvProgress');
  document.addEventListener('tour-step',e=>{ const d=e.detail||{}; pill.textContent=(d.index+1)+' / '+d.total; barSpan.style.width=Math.round(((d.index+1)/d.total)*100)+'%'; });
  mv.addEventListener('progress',e=>{ const pct=Math.round(e.detail.totalProgress*100); barSpan.style.width=pct+'%'; });
  // settings modal
  const modal=document.createElement('div'); modal.className='modal'; modal.id='settingsModal';
  modal.innerHTML='<div class="box"><h3 style="margin-top:0">Ajustes</h3><div class="row"><label>Auto-rotar</label><input type="checkbox" id="setAuto"></div><div class="row"><label>Velocidad</label><input type="range" min="0" max="0.008" step="0.0005" id="setSpeed"></div><div class="row"><label>Campo de visión (FOV)</label><input type="range" min="25" max="90" step="1" id="setFov"></div><div class="row"><label>Sombras</label><input type="checkbox" id="setShadows"></div><div class="row" style="justify-content:flex-end"><button class="btn grad-blue" id="setClose">Cerrar</button></div></div>';
  document.body.appendChild(modal);
  document.getElementById('btn-settings').addEventListener('click',()=>modal.classList.add('show'));
  document.addEventListener('click',e=>{ if(e.target && e.target.id==='setClose') modal.classList.remove('show'); });
  mv.addEventListener('load',()=>{
    document.getElementById('setAuto').checked=!!mv.autoRotate;
    document.getElementById('setSpeed').value=mv.autoRotateSpeed||0.0015;
    document.getElementById('setFov').value=(mv.fieldOfView||'45deg').replace('deg','');
    document.getElementById('setShadows').checked=(mv.shadowIntensity||0)>0;
  });
  document.addEventListener('input',e=>{
    if(e.target && e.target.id==='setSpeed') mv.autoRotateSpeed=parseFloat(e.target.value);
    if(e.target && e.target.id==='setFov') mv.fieldOfView=e.target.value+'deg';
  });
  document.addEventListener('change',e=>{
    if(e.target && e.target.id==='setAuto') mv.autoRotate=e.target.checked;
    if(e.target && e.target.id==='setShadows') mv.shadowIntensity=e.target.checked?0.5:0.0;
  });
})();
</script>

<script>
(function(){
  const root = document.documentElement;
  const btn = document.getElementById('themeToggle');
  const saved = localStorage.getItem('theme');
  if(saved){ root.setAttribute('data-theme', saved); }
  btn && btn.addEventListener('click', ()=>{
    const cur = root.getAttribute('data-theme')==='light' ? 'dark':'light';
    root.setAttribute('data-theme', cur);
    localStorage.setItem('theme', cur);
  });
})();
</script>

</body></html>
